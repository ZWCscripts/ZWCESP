--// Neon Box ESP + Mesafe + Name + Line (Her oyunda, duvar arkası, PC-Mobil)

local ESP_COLOR = Color3.fromRGB(0, 255, 255) -- Neon mavi
local ESP_THICKNESS = 2
local FONT = Enum.Font.GothamBold

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Neon kutu için SurfaceGui'ler (Avatarı fazla bozmadan)
local function addBoxESP(char)
    if not char or char:FindFirstChild("ESP_BOX") then return end
    for _,part in ipairs({"HumanoidRootPart","UpperTorso","Torso"}) do
        if char:FindFirstChild(part) then
            local box = Instance.new("BoxHandleAdornment")
            box.Name = "ESP_BOX"
            box.Adornee = char[part]
            box.AlwaysOnTop = true
            box.ZIndex = 10
            box.Size = char[part].Size + Vector3.new(0.1,0.1,0.1)
            box.Transparency = 0.6
            box.Color3 = ESP_COLOR
            box.LineThickness = ESP_THICKNESS
            box.Parent = char
            break
        end
    end
end

local function removeBoxESP(char)
    if char and char:FindFirstChild("ESP_BOX") then
        char.ESP_BOX:Destroy()
    end
end

local function addNeonOutline(char)
    for _,v in ipairs(char:GetChildren()) do
        if v:IsA("BasePart") and not v:FindFirstChild("ESP_NEON") then
            local neon = Instance.new("SelectionBox")
            neon.Name = "ESP_NEON"
            neon.Adornee = v
            neon.LineThickness = 0.06
            neon.Color3 = ESP_COLOR
            neon.SurfaceColor3 = ESP_COLOR
            neon.SurfaceTransparency = 0.4
            neon.Parent = v
        end
    end
end

local function removeNeonOutline(char)
    for _,v in ipairs(char:GetChildren()) do
        if v:IsA("BasePart") and v:FindFirstChild("ESP_NEON") then
            v.ESP_NEON:Destroy()
        end
    end
end

-- Billboard ESP (isim, mesafe, çizgi)
local function addBillboardESP(plr, char)
    if char:FindFirstChild("ESP_BILL") then return end
    local bb = Instance.new("BillboardGui")
    bb.Name = "ESP_BILL"
    bb.Adornee = char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
    bb.Size = UDim2.new(0, 200, 0, 60)
    bb.AlwaysOnTop = true
    bb.StudsOffset = Vector3.new(0, 2, 0)
    bb.Parent = char

    local name = Instance.new("TextLabel")
    name.BackgroundTransparency = 1
    name.TextColor3 = ESP_COLOR
    name.TextStrokeTransparency = 0.4
    name.Font = FONT
    name.TextSize = 18
    name.Size = UDim2.new(1,0,0.5,0)
    name.Text = plr.DisplayName or plr.Name
    name.Parent = bb

    local dist = Instance.new("TextLabel")
    dist.BackgroundTransparency = 1
    dist.TextColor3 = ESP_COLOR
    dist.TextStrokeTransparency = 0.3
    dist.Font = FONT
    dist.TextSize = 16
    dist.Position = UDim2.new(0,0,0.5,0)
    dist.Size = UDim2.new(1,0,0.5,0)
    dist.Name = "ESP_DIST"
    dist.Text = ""
    dist.Parent = bb
end

local function removeBillboardESP(char)
    if char and char:FindFirstChild("ESP_BILL") then
        char.ESP_BILL:Destroy()
    end
end

-- ESP Güncelleme (mesafe, çizgi)
local function updateESP(plr, char)
    if char:FindFirstChild("ESP_BILL") then
        local root = char:FindFirstChild("HumanoidRootPart")
        if root then
            local dist = (root.Position - Camera.CFrame.Position).Magnitude
            local distLabel = char.ESP_BILL:FindFirstChild("ESP_DIST")
            if distLabel then
                distLabel.Text = string.format("%.0fm", dist/3.3) -- Roblox'ta 1m ≈ 3.3 studs
            end
        end
    end
end

-- ESP ekle/çıkar
local function addESP(plr)
    if plr == Players.LocalPlayer then return end
    local function charAdded(char)
        addBoxESP(char)
        addNeonOutline(char)
        addBillboardESP(plr, char)
        char.AncestryChanged:Connect(function(_, parent)
            if not parent then
                removeBoxESP(char)
                removeNeonOutline(char)
                removeBillboardESP(char)
            end
        end)
    end
    if plr.Character then charAdded(plr.Character) end
    plr.CharacterAdded:Connect(charAdded)
end

local function removeESP(plr)
    if plr.Character then
        removeBoxESP(plr.Character)
        removeNeonOutline(plr.Character)
        removeBillboardESP(plr.Character)
    end
end

-- Tüm oyunculara uygula
for _,plr in ipairs(Players:GetPlayers()) do
    addESP(plr)
end
Players.PlayerAdded:Connect(addESP)
Players.PlayerRemoving:Connect(removeESP)

-- Mesafe güncellemesi
RunService.RenderStepped:Connect(function()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= Players.LocalPlayer and plr.Character then
            updateESP(plr, plr.Character)
        end
    end
end)
